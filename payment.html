<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í”„ë¦¬ë¯¸ì—„ ê²°ì œ | ë‚˜ë§Œì˜ ì²­ì²©ì¥</title>
  <link rel="stylesheet" href="payment.css">
</head>
<body>
  <div class="payment-container">
    <h1>ğŸ’ í”„ë¦¬ë¯¸ì—„ í…œí”Œë¦¿ ê²°ì œ</h1>
    <div class="premium-info">
      <div class="premium-title">í”„ë¦¬ë¯¸ì—„ í…œí”Œë¦¿</div>
      <div class="premium-desc">ë” ê³ ê¸‰ìŠ¤ëŸ½ê³  íŠ¹ë³„í•œ ì²­ì²©ì¥ì„ ì›í•˜ì‹œë‚˜ìš”?<br>í”„ë¦¬ë¯¸ì—„ í…œí”Œë¦¿ì„ ì„ íƒí•˜ì‹œë©´ ê´‘ê³  ì—†ì´ ë‹¤ì–‘í•œ í˜œíƒì„ ëˆ„ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
      <div class="premium-price">ê°€ê²©: <span id="premium-price">9,900ì›</span></div>
    </div>
    <div class="payment-methods">
      <button class="pay-btn kakao">ì¹´ì¹´ì˜¤í˜ì´ ê²°ì œ</button>
      <button class="pay-btn toss">í† ìŠ¤ ê²°ì œ</button>
      <button class="pay-btn card">ì¹´ë“œ ê²°ì œ</button>
    </div>
    <div class="payment-message" id="payment-message">ê²°ì œ í›„ í”„ë¦¬ë¯¸ì—„ ê¸°ëŠ¥ì´ ì¦‰ì‹œ í™œì„±í™”ë©ë‹ˆë‹¤.</div>
    <a href="/" class="home-link">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
  </div>
  <script type="module">
    import { supabase } from './supabase.js';

    // ì´ˆëŒ€ì¥ ê³ ìœ ì½”ë“œ(ì¿¼ë¦¬ìŠ¤íŠ¸ë§)
    const inviteId = new URLSearchParams(window.location.search).get('id') || 'abcd1234';
    // ê²°ì œ ê¸ˆì•¡/ìƒí’ˆ ì •ë³´
    const price = 9900;
    const product = 'í”„ë¦¬ë¯¸ì—„ í…œí”Œë¦¿';

    // ê²°ì œ ì²˜ë¦¬ í•¨ìˆ˜(ì‹¤ì œ ê²°ì œ ì—°ë™ ëŒ€ì‹  alert, ê²°ì œ ì„±ê³µ ì‹œ supabase ì €ì¥)
    async function handlePayment(method) {
      // ì‹¤ì œ ê²°ì œ ì—°ë™ì€ ê° PGì‚¬ SDK/API ì‚¬ìš©
      alert(`${method} ê²°ì œ í…ŒìŠ¤íŠ¸: ê²°ì œê°€ ì„±ê³µí–ˆë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.`);
      // ê²°ì œ ë‚´ì—­ supabase ì €ì¥
      const { error } = await supabase.from('payments').insert([{
        invite_id: inviteId,
        product,
        price,
        method,
        paid_at: new Date().toISOString()
      }]);
      if (error) {
        document.getElementById('payment-message').textContent = 'ê²°ì œ ë‚´ì—­ ì €ì¥ ì‹¤íŒ¨: ' + error.message;
        return;
      }
      // í”„ë¦¬ë¯¸ì—„ í™œì„±í™” (invitations í…Œì´ë¸” ì—…ë°ì´íŠ¸)
      await supabase.from('invitations').update({ is_premium: true }).eq('id', inviteId);
      // ê²°ì œ ì™„ë£Œ ì•ˆë‚´ ë° ì´ë™
      document.getElementById('payment-message').innerHTML = 'ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!<br><a href="create-invite-success.html?id='+inviteId+'">ì²­ì²©ì¥ìœ¼ë¡œ ì´ë™</a>';
    }

    document.querySelector('.pay-btn.kakao').addEventListener('click', () => handlePayment('ì¹´ì¹´ì˜¤í˜ì´'));
    document.querySelector('.pay-btn.toss').addEventListener('click', () => handlePayment('í† ìŠ¤'));
    document.querySelector('.pay-btn.card').addEventListener('click', () => handlePayment('ì¹´ë“œ'));
  </script>
</body>
</html> 